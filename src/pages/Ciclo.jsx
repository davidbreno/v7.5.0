import { useState } from 'react'
import { Link } from 'react-router-dom'
import Sidebar from '../components/Sidebar'
import Modal from '../components/Modal'
import { DAYS, addCycle, updateCycle, removeCycle, load } from '../data/store'
function Header({ title }){ return (<header className="topbar"><div className="brand">{title}</div><nav className="menu"><Link to="/">Dashboard</Link></nav></header>) }
export default function Ciclo(){ const [data,setData]=useState(load()); const items=data.ciclo.itens; const [editing,setEditing]=useState(null); function submitNew(e){e.preventDefault(); const f=new FormData(e.currentTarget); setData(addCycle({ composto:f.get('composto'), dosagem:Number(f.get('dosagem')), quantidade:Number(f.get('quantidade')), dia:f.get('dia') })); e.currentTarget.reset()} function submitEdit(e){e.preventDefault(); const f=new FormData(e.currentTarget); setData(updateCycle(editing.id,{ composto:f.get('composto'), dosagem:Number(f.get('dosagem')), quantidade:Number(f.get('quantidade')), dia:f.get('dia') })); setEditing(null)} function remove(id){ setData(removeCycle(id)) } return (<div className="layout"><Sidebar /><div><Header title="Ciclo" /><div className="wrap"><div className="widget"><h3 className="font-semibold mb-2">Adicionar</h3><form onSubmit={submitNew} className="grid grid-cols-2 md:grid-cols-6 gap-2"><input name="composto" placeholder="Composto" className="bg-[color:var(--panel)] border border-white/10 rounded px-3 py-2 md:col-span-2" required /><input name="dosagem" type="number" placeholder="Dosagem (mg)" className="bg-[color:var(--panel)] border border-white/10 rounded px-3 py-2" required /><input name="quantidade" type="number" placeholder="Qtd" className="bg-[color:var(--panel)] border border-white/10 rounded px-3 py-2" required /><select name="dia" className="bg-[color:var(--panel)] border border-white/10 rounded px-3 py-2" required defaultValue="Seg">{DAYS.map(d=><option key={d} value={d}>{d}</option>)}</select><button className="rounded text-white font-semibold px-4 md:col-span-1 col-span-2" style={{background:'linear-gradient(90deg,var(--brand1),var(--brand2),var(--brand3))'}}>Salvar</button></form></div><div className="widget"><h3 className="font-semibold mb-2">Tabela</h3><table className="w-full text-sm"><thead className="text-white/80"><tr><th className="text-left py-2">Composto</th><th className="text-right">Dosagem</th><th className="text-right">Qtd</th><th className="text-center">Dia</th><th className="text-right">Total</th><th></th></tr></thead><tbody>{items.map(i=>(<tr key={i.id} className="border-t border-white/10"><td className="py-2">{i.composto}</td><td className="text-right">{i.dosagem}</td><td className="text-right">{i.quantidade}</td><td className="text-center">{i.dia}</td><td className="text-right">{(i.dosagem*i.quantidade)||0}</td><td className="text-right"><button onClick={()=>setEditing(i)} className="px-3 py-1 rounded bg-white/10 hover:bg-white/20 mr-2">Editar</button><button onClick={()=>remove(i.id)} className="px-3 py-1 rounded bg-red-500/70 hover:bg-red-500/90">Apagar</button></td></tr>))}{items.length===0&&<tr><td colSpan={6} className="text-center py-6 text-white/60">Sem dados.</td></tr>}</tbody></table></div></div></div><Modal open={!!editing} title="Editar Item do Ciclo" onClose={()=>setEditing(null)}><form onSubmit={submitEdit} className="grid grid-cols-2 md:grid-cols-6 gap-2"><input name="composto" defaultValue={editing?.composto} className="bg-[color:var(--panel)] border border-white/10 rounded px-3 py-2 md:col-span-2" /><input name="dosagem" type="number" defaultValue={editing?.dosagem} className="bg-[color:var(--panel)] border border-white/10 rounded px-3 py-2" /><input name="quantidade" type="number" defaultValue={editing?.quantidade} className="bg-[color:var(--panel)] border border-white/10 rounded px-3 py-2" /><select name="dia" defaultValue={editing?.dia} className="bg-[color:var(--panel)] border border-white/10 rounded px-3 py-2">{DAYS.map(d=><option key={d} value={d}>{d}</option>)}</select><button className="rounded text-white font-semibold px-4" style={{background:'linear-gradient(90deg,var(--brand1),var(--brand2),var(--brand3))'}}>Salvar</button></form></Modal></div>) }