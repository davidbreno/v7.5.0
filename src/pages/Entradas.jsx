import { useState } from 'react'
import { Link } from 'react-router-dom'
import Sidebar from '../components/Sidebar'
import Modal from '../components/Modal'
import { addTransaction, updateTransaction, deleteTransaction, load } from '../data/store'
function Header({ title }){ return (<header className="topbar"><div className="brand">{title}</div><nav className="menu"><Link to="/">Dashboard</Link></nav></header>) }
export default function Entradas(){ const [data,setData]=useState(load()); const [editing,setEditing]=useState(null); function submitNew(e){e.preventDefault(); const f=new FormData(e.currentTarget); const tx={ tipo:f.get('tipo'), descricao:f.get('desc'), valor:Number(f.get('valor')), data:f.get('data') }; setData(addTransaction(tx)); e.currentTarget.reset()} function submitEdit(e){e.preventDefault(); const f=new FormData(e.currentTarget); setData(updateTransaction(editing.id,{ tipo:f.get('tipo'), descricao:f.get('desc'), valor:Number(f.get('valor')), data:f.get('data') })); setEditing(null)} function remove(id){ setData(deleteTransaction(id)) } return (<div className="layout"><Sidebar /><div><Header title="Entradas & Saídas" /><div className="wrap"><div className="widget"><h3 className="font-semibold mb-2">Adicionar</h3><form onSubmit={submitNew} className="grid grid-cols-2 md:grid-cols-6 gap-2"><select name="tipo" className="bg-[color:var(--panel)] border border-white/10 rounded px-3 py-2" required defaultValue="entrada"><option value="entrada">Entrada</option><option value="saida">Saída</option></select><input name="desc" placeholder="Descrição" className="bg-[color:var(--panel)] border border-white/10 rounded px-3 py-2 md:col-span-2" required /><input name="valor" type="number" step="0.01" placeholder="Valor" className="bg-[color:var(--panel)] border border-white/10 rounded px-3 py-2" required /><input name="data" type="date" className="bg-[color:var(--panel)] border border-white/10 rounded px-3 py-2" required /><button className="rounded text-white font-semibold px-4" style={{background:'linear-gradient(90deg,var(--brand1),var(--brand2),var(--brand3))'}}>Salvar</button></form></div><div className="widget"><h3 className="font-semibold mb-2">Registros</h3><table className="w-full text-sm"><thead className="text-white/80"><tr><th className="text-left py-2">Tipo</th><th>Descrição</th><th className="text-right">Valor</th><th className="text-center">Data</th><th></th></tr></thead><tbody>{data.financas.transacoes.map(t=>(<tr key={t.id} className="border-t border-white/10"><td className="py-2">{t.tipo}</td><td>{t.descricao}</td><td className="text-right">{t.valor}</td><td className="text-center">{t.data}</td><td className="text-right"><button onClick={()=>setEditing(t)} className="px-3 py-1 rounded bg-white/10 hover:bg-white/20 mr-2">Editar</button><button onClick={()=>remove(t.id)} className="px-3 py-1 rounded bg-red-500/70 hover:bg-red-500/90">Apagar</button></td></tr>))}{data.financas.transacoes.length===0&&<tr><td colSpan={5} className="text-center py-6 text-white/60">Sem dados.</td></tr>}</tbody></table></div></div></div><Modal open={!!editing} title="Editar Transação" onClose={()=>setEditing(null)}><form onSubmit={submitEdit} className="grid grid-cols-2 md:grid-cols-6 gap-2"><select name="tipo" defaultValue={editing?.tipo} className="bg-[color:var(--panel)] border border-white/10 rounded px-3 py-2"><option value="entrada">Entrada</option><option value="saida">Saída</option></select><input name="desc" defaultValue={editing?.descricao} className="bg-[color:var(--panel)] border border-white/10 rounded px-3 py-2 md:col-span-2" /><input name="valor" type="number" step="0.01" defaultValue={editing?.valor} className="bg-[color:var(--panel)] border border-white/10 rounded px-3 py-2" /><input name="data" type="date" defaultValue={editing?.data} className="bg-[color:var(--panel)] border border-white/10 rounded px-3 py-2" /><button className="rounded text-white font-semibold px-4" style={{background:'linear-gradient(90deg,var(--brand1),var(--brand2),var(--brand3))'}}>Salvar</button></form></Modal></div>) }